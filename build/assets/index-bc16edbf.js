import{aa as F,bF as C,bG as m,bH as M,p as B,E as k,F as d,r as x,D as V,j as n,aL as $,Q as E,A as z}from"./index-cfbf289f.js";import{p as A,B as S,q as _,F as G}from"./index-ccb23ece.js";import{B as R}from"./index-2e3859ae.js";import{S as I}from"./index-be3e05d9.js";import{A as K}from"./index-2086ecb5.js";import{T as N}from"./index-cefd9bd5.js";import"./index.esm-39483f52.js";import"./Stack-4a3ce72f.js";import"./createSvgIcon-f1a19413.js";import"./TextareaAutosize-3257f3f6.js";const D="https://community.sphinx.chat",O=async e=>await F.post("/bounty",JSON.stringify(e)),q=async e=>await C(`${D}/person/${e}`,{headers:{"Content-Type":"application/json"},method:"GET"}),L=async e=>await C(`${D}/workspaces/user/${e}`,{headers:{"Content-Type":"application/json"},method:"GET"});async function P(){try{const e=Math.floor(Date.now()/1e3),t=m.Buffer.from(e.toString(16),"hex"),r=m.Buffer.from(t).toString("base64"),s=await M.signMessage(r),a=W(s.signature),l=m.Buffer.concat([t,a],a.length+t.length);return H(l)}catch(e){return console.log("error from signing more message: ",e),""}}function W(e){const t=e.replace(/_/g,"/").replace(/-/g,"+"),r=t.padEnd(t.length+(4-t.length%4)%4,"=");return m.Buffer.from(r,"base64")}function H(e){let t="";const r=e.byteLength;for(let a=0;a<r;a+=1)t+=String.fromCharCode(e[a]);return btoa(t).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}const U=/^[0-9]+$/,v=e=>{const t=e.trim();return!!(t&&U.test(t))},J=({errMessage:e,handleClose:t})=>{const{setValue:r,watch:s}=A(),[a,l]=x.useState([]),{pubKey:c}=V();x.useEffect(()=>{async function o(){try{const i=await q(c);if(!i.id){l([{label:"SecondBrain",value:"SecondBrain"}]);return}const p=await L(i.id);if(p.length>0){const w=[];for(let b=0;b<p.length;b+=1){const j=p[b];w.push({label:j.name,value:j.uuid})}l(w)}}catch(i){console.log("Error from get user details: ",i)}}o()},[c]);const u=s("budget",""),g=s("nodeType",""),f=o=>{const i=(o==null?void 0:o.label)||"SecondBrain",p=(o==null?void 0:o.value)||"ck9drb84nncjnaefo090";r("nodeType",i,{shouldValidate:!0}),r("workspaceUuid",p)},y=v(u)&&!!g,h=o=>{o.key===" "&&o.preventDefault()};return n.jsxs(d,{children:[n.jsx(d,{align:"center",direction:"row",justify:"space-between",mb:18,children:n.jsx(Q,{children:"Create Bounty"})}),n.jsxs(d,{mb:20,children:[n.jsx(T,{children:"Select Workspace"}),n.jsx(K,{autoFocus:!0,onSelect:f,options:a})]}),n.jsxs(d,{mb:20,children:[n.jsx(T,{children:"Set Budget"}),n.jsx(N,{id:"budget",name:"budget",onKeyDown:h,placeholder:"Enter budget",rules:{...$,pattern:{value:U,message:"Please enter a valid number"}},value:u})]}),n.jsxs(d,{direction:"row",children:[n.jsx(d,{grow:1,children:n.jsx(S,{color:"secondary",onClick:()=>t(),size:"large",variant:"contained",children:"Cancel"})}),n.jsx(d,{grow:1,ml:20,children:n.jsx(S,{color:"secondary",disabled:!y,size:"large",type:"submit",variant:"contained",children:"Confirm"})})]}),e&&n.jsx(X,{children:e})]})},T=B(k)`
  font-size: 14px;
  font-weight: 600;
  font-family: 'Barlow';
  margin-bottom: 6px;
`,Q=B(k)`
  font-size: 18px;
  font-weight: 600;
  font-family: 'Barlow';
  margin-bottom: 6px;
`,X=B(d)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`,Y=()=>{const[e,t]=x.useState(""),{close:r}=E("createBounty"),s=z(),a=_({mode:"onChange"}),{handleSubmit:l,setValue:c}=a,u=()=>{c("budget",""),c("nodeType",""),c("workspaceUuid",""),r()},g=async f=>{const{budget:y,workspaceUuid:h}=f;try{const o=await P(),i={type:"code_generation",amount:Number(y),workspace_uuid:h||"ck9drb84nncjnaefo090",ref_id:s==null?void 0:s.ref_id,node_data:(s==null?void 0:s.properties)||{},jwt_token:o};await O(i),I("Bounty Created")}catch(o){t(o)}finally{c("budget",""),c("nodeType",""),c("workspaceUuid",""),u()}};return n.jsx(G,{...a,children:n.jsx("form",{id:"create-bounty-form",onSubmit:l(g),children:n.jsx(J,{errMessage:e,handleClose:u})})})},de=()=>{const{close:e}=E("createBounty"),t=_({mode:"onChange"}),{setValue:r}=t,s=()=>{r("budget",""),r("nodeType",""),e()},a="small";return n.jsx(R,{id:"createBounty",kind:a,onClose:s,preventOutsideClose:!0,children:n.jsx(Y,{})})};export{de as CreateBountyModal};
